#include <stdio.h>
#include <stdlib.h>



int n, W, maxprofit;

int numbest;
int *bestset;

int *include;
int *w;
int *p;


void initial(void);

void destroy(void);

void knapsack(int i, int profit, int weight);

int promising(int i, int profit, int weight);

int main(int argc, char* argv[]){
  printf("Number of the Items > ");
  scanf("%d", &n);

  printf("Weight of the knapsack > ");
  scanf("%d", &W);

  initial();

  for (int i=1; i<=n; i++){
    printf("The Price of the Item %d > ", i);
    scanf("%d", &p[i]);
    printf("The Weight of the Item %d > ", i);
    scanf("%d", &w[i]);
  }

  
  knapsack(0, 0, 0);

  for (int i=1; i<=numbest; i++){
    if (bestset[i])
      printf("Item %d: YES\n", i);
    else
      printf("Item %d: NO\n", i);
  }

  destroy();
  return 0;
}

void initial(void){
  bestset = (int*)malloc(sizeof(int)*(n+1));
  include = (int*)malloc(sizeof(int)*(n+1));
  w = (int*)malloc(sizeof(int)*(n+1));
  p = (int*)malloc(sizeof(int)*(n+1));

  maxprofit = 0;
  numbest = 0;
}

void destroy(void){
  free(bestset);
  free(include);
  free(w);
  free(p);
}

void knapsack(int i, int profit, int weight){
  if (weight <= W && profit > maxprofit){
    maxprofit = profit;
    numbest = i;
    for (int j=1; j<=numbest; j++){
      bestset[j] = include[j];
    }
  }

  if (promising(i, profit, weight)){
    include[i+1] = 1;
    knapsack(i+1, profit+p[i+1], weight+w[i+1]);
    include[i+1] = 0;
    knapsack(i+1, profit, weight);
  }
}

int promising(int i, int profit, int weight){
  int j, k;
  int totweight;
  float bound;

  if (weight >= W) return 0;
  else{
    j = i+1;
    bound = (float)profit;
    totweight = weight;
    while ((j <= n) && (totweight + w[j] <= W)){
      totweight = totweight + w[j];
      bound += p[j];
      j++;
    }
    if (j <= n){
      bound += ((float)(W-totweight)) * ((float)p[j] / (float)w[j]);
    }
    return bound > maxprofit;
  }
}
