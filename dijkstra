#include <stdio.h>
#include <stdlib.h>
#define INF 1000000

typedef struct Edge{
  int v;
  int w;
  int weight;
}Edge;

void dijkstra(int n, const int **W, Edge *F);

int main(int argc, char *argv[]){
  int n;
  printf("Enter the Number of vertices > ");
  scanf("%d", &n);

  int **W = (int**)malloc(sizeof(int*)*n);
  for (int i=0; i<n; i++){
    W[i] = (int*)malloc(sizeof(int)*n);
    for (int j=0; j<n; j++){
      printf("Weight of the edge from v%d to v%d > ", i+1, j+1);
      scanf("%d", &W[i][j]);

      if (W[i][j] == -1){
        W[i][j] = INF;
      }
    }
  }

  Edge *F = (Edge*)malloc(sizeof(Edge)*(n-1));

  dijkstra(n, (const int**)W, F);

  for (int i=0; i<n-1; i++){
    printf("Edge: ( %d, %d ), Weight: %d\n", F[i].v, F[i].w, F[i].weight);
  }

  free(F);
  for (int i=0; i<n; i++){
    free(W[i]);
  }
  free(W);
  return 0;
}

void dijkstra(int n, const int **W, Edge *F){
  int i, vnear; Edge e;
  int touch[n+1], length[n+1];
  int cntF = 0;
  for (i=2; i<=n; i++){
    touch[i] = 1;
    length[i] = W[1-1][i-1];
  }

  while (cntF < n-1){
    int min = INF;
    for (i=2; i<=n; i++){
      if (length[i] >= 0 && length[i] <= min){
        min = length[i];
        vnear = i;
      }
    }

    e.v = touch[vnear];
    e.w = vnear;
    e.weight = W[touch[vnear]-1][vnear-1];

    F[cntF] = e;
    cntF++;

    for (i=2; i<=n; i++){
      if (length[vnear] + W[vnear-1][i-1] < length[i]){
        length[i] = length[vnear] + W[vnear-1][i-1];
        touch[i] = vnear;
      }
    }
    length[vnear] = -1;
  }
}
